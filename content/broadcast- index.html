{"id":"58621","variant":"standard","title":"Broadcast","recipient":""}
<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LOST & FOUND</title>
<style>
  body {
    margin:0;
    font-family:sans-serif;
    background:#ccc; /* 灰色背景 */
    color:#222;
  }
  h1.title {
    text-align:center;
    color:white;
    margin-top:2rem;
    font-size:2.5rem;
  }
  #broadcast-wrapper {
    position:fixed;
    bottom:1rem;
    right:50%;
    transform:translateX(50%);
    width:300px;
    z-index:9999;
    background:rgba(255,255,255,0.05);
    border-radius:8px;
    padding:0.5rem 1rem;
  }
  #broadcasts {
    max-height:200px;
    overflow-y:auto;
    color:white;
    font-size:0.95rem;
    margin-bottom:0.5rem;
  }
  #broadcast-input {
    width:calc(100% - 60px);
    padding:0.3rem;
    border-radius:4px;
    border:none;
  }
  #broadcast-send {
    padding:0.3rem 0.5rem;
    border:none;
    border-radius:4px;
    background:#222;
    color:#fff;
    cursor:pointer;
  }
  /* LOST & FOUND 底部效果 */
  .global-footer {
    text-align:center;
    margin-top:2rem;
    font-style:italic;
    color:#777;
  }
  .dissolve {
    animation: dissolveAnim 1.2s forwards;
  }
  @keyframes dissolveAnim {
    0% {opacity:1; transform:scale(1);}
    100% {opacity:0; transform:scale(0.3) rotate(10deg);}
  }
</style>
</head>
<body>

<h1 class="title">在不可能之海里</h1>

<!-- 广播区域 -->
<div id="broadcast-wrapper">
  <div id="broadcasts">加载中…</div>
  <div style="display:flex; gap:0.3rem;">
    <input type="text" id="broadcast-input" placeholder="输入广播信息">
    <button id="broadcast-send">Send</button>
  </div>
</div>

<!-- LOST & FOUND 点击效果 -->
<div class="global-footer" id="lostfound" style="cursor:pointer;">
  LOST & FOUND 像水消失在水中
</div>

<!-- Firebase + Authentication + Firestore -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js";
import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-auth.js";
import { getFirestore, collection, addDoc, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-firestore.js";

// Firebase 配置
const firebaseConfig = {
  apiKey: "AIzaSyCcerqGJVSsMwLs7eoRjATE8X7bplWsD54",
  authDomain: "drunk-broadcast.firebaseapp.com",
  projectId: "drunk-broadcast",
  storageBucket: "drunk-broadcast.firebasestorage.app",
  messagingSenderId: "998143016108",
  appId: "1:998143016108:web:87c3a60b853aaf75f27309"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// 匿名登录
signInAnonymously(auth).catch(console.error);

const inputEl = document.getElementById("broadcast-input");
const sendBtn = document.getElementById("broadcast-send");
const listEl = document.getElementById("broadcasts");

// 用户登录状态
onAuthStateChanged(auth, user => {
  if (!user) return;

  // 发送广播
  sendBtn.addEventListener("click", async () => {
    const text = inputEl.value.trim();
    if (!text) return;
    try {
      await addDoc(collection(db, "broadcasts"), {
        message: text,
        timestamp: new Date(),
        uid: user.uid
      });
      inputEl.value = "";
    } catch (e) {
      console.error("发送广播失败:", e);
    }
  });

  // 回车发送
  inputEl.addEventListener("keydown", e => {
    if(e.key === "Enter") sendBtn.click();
  });

  // 实时显示广播
  const q = query(collection(db, "broadcasts"), orderBy("timestamp","desc"));
  onSnapshot(q, snapshot => {
    listEl.innerHTML = "";
    snapshot.forEach(doc => {
      const div = document.createElement("div");
      div.textContent = doc.data().message;
      div.style.marginBottom = "0.3rem";
      listEl.appendChild(div);
    });
  }, error => {
    console.error("监听广播失败:", error);
    listEl.textContent = "加载失败";
  });
});
</script>

<!-- LOST & FOUND 点击跳转 -->
<script>
document.getElementById("lostfound").addEventListener("click", function () {
  this.classList.add("dissolve");
  setTimeout(() => { window.location.href = "/drunk/"; }, 1200);
});
</script>

</body>
</html>
