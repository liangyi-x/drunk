{{ define "main" }}

<style>
/* 首页卡片 grid */
.posts-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 2.3rem;
  max-width: 960px;
  margin: 2.5rem auto 0 auto;
  padding: 0 1rem;
}

/* 首页标题 */
.home-title {
  text-align: center;
  font-size: 2rem;
  font-weight: 500;
  margin-bottom: 1.2rem;
  color: #222;
}

/* 卡片 */
.post-card {
  background: #fff;
  border-radius: 12px;
  padding: 1.3rem;
  box-shadow: 0 4px 14px rgba(0,0,0,0.05);
  transition: transform 0.25s ease, box-shadow 0.25s ease;
}
.post-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 30px rgba(0,0,0,0.10);
}
.post-card h3 {
  margin: 0;
  font-size: 1.45rem;
  color: #222;
  transition: color 0.25s ease;
}
.post-card h3:hover { color: #000; }
.post-excerpt {
  margin-top: 0.6rem;
  font-size: 1rem;
  color: #555;
  line-height: 1.6;
}
.post-card a { color: inherit; text-decoration: none; }

/* More 按钮 */
.more-posts-button {
  display: inline-block;
  margin: 1.5rem auto;
  padding: 0.55rem 1.5rem;
  background: #222;
  color: #fff;
  font-weight: 500;
  border-radius: 8px;
  cursor: pointer;
  text-decoration: none;
  transition: background 0.25s ease, transform 0.2s ease;
}
.more-posts-button:hover {
  background: #444;
  transform: translateY(-2px);
}

/* posts 列表页 */
.all-posts-list { max-width: 700px; margin: 2rem auto; padding: 0 1rem; }
.all-posts-list ul { list-style: none; padding-left: 0; }
.all-posts-list li { padding: 0.6rem 0; border-bottom: 1px solid #eee; }
.all-posts-list a { text-decoration: none; color: #222; font-size: 1.12rem; font-weight: 500; }
.all-posts-list a:hover { color: #000; }
.excerpt { font-size: 0.95rem; color: #666; margin-top: 0.2rem; }

/* 分页 */
.pagination a, .pagination strong { margin: 0 0.35rem; font-size: 0.95rem; text-decoration: none; }
.pagination a { color: #444; } .pagination a:hover { color: #000; }
.pagination strong { color: #000; font-weight: bold; }

/* Footer */
.global-footer { text-align: center; margin: 2.5rem 0 0.5rem 0; font-style: italic; color: #777; }

/* 弹窗订阅 */
.subscribe-button {
  display: inline-block;
  margin: 1rem auto 2rem auto;
  padding: 0.55rem 1.5rem;
  background: #222;
  color: #fff;
  font-weight: 500;
  border-radius: 8px;
  cursor: pointer;
  text-decoration: none;
  transition: background 0.25s ease, transform 0.2s ease;
}
.subscribe-button:hover { background:#444; transform: translateY(-2px);}
.subscribe-overlay {
  display: none;
  position: fixed;
  top:0; left:0;
  width:100%; height:100%;
  background: rgba(0,0,0,0.6);
  z-index: 999;
  justify-content: center;
  align-items: center;
}
.subscribe-popup {
  background: #fff;
  padding: 1rem;
  border-radius: 12px;
  max-width: 480px;
  width: 90%;
  text-align: center;
  position: relative;
}
.subscribe-popup .close-btn {
  position: absolute;
  top:0.5rem; right:0.5rem;
  font-size:1.2rem;
  font-weight:bold;
  cursor:pointer;
}
.subscribe-popup iframe {
  width:100%; height:320px; border:none; background:white;
}

/* 手机端 */
@media (max-width:480px){
  .posts-grid { gap:2rem; padding-top:1rem; padding-bottom:1rem;}
  .post-card{padding:1rem;}
}
</style>

{{ $isHome := .IsHome }}
{{ $isPosts := eq .Type "posts" }}
{{ $isTag := eq .Kind "term" }}

{{ if $isHome }}
<div class="home-title">Article</div>
<div class="posts-grid">
  {{ range first 3 (where .Site.RegularPages "Type" "posts") }}
    <div class="post-card">
      <h3><a href="{{ .RelPermalink }}">{{ .Title }}</a></h3>
      <p class="post-excerpt">{{ .Summary }}</p>
    </div>
  {{ end }}
</div>
<div style="text-align:center;">
  <a class="more-posts-button" href="/drunk/posts/">More</a>
</div>

{{ else if $isPosts }}
<div class="all-posts-list">
  <div class="home-title">All Posts</div>
  {{ $paginator := .Paginate (where .Site.RegularPages "Type" "posts") }}
  <ul>
    {{ range $paginator.Pages }}
      <li>
        <a href="{{ .RelPermalink }}">{{ .Title }}</a>
        <div class="excerpt">{{ .Summary }}</div>
      </li>
    {{ end }}
  </ul>
  <div class="pagination" style="text-align:center; margin-top:1.5rem;">
    {{ if $paginator.HasPrev }}<a href="{{ $paginator.Prev.URL }}">← Prev</a>{{ end }}
    <strong>{{ $paginator.PageNumber }}</strong>
    {{ if $paginator.HasNext }}<a href="{{ $paginator.Next.URL }}">Next →</a>{{ end }}
  </div>
</div>

{{ else if $isTag }}
<div class="all-posts-list">
  <div class="home-title">#{{ .Title }}</div>
  {{ $paginator := .Paginate .Pages }}
  <ul>
    {{ range $paginator.Pages }}
      <li>
        <a href="{{ .RelPermalink }}">{{ .Title }}</a>
        <div class="excerpt">{{ .Summary }}</div>
      </li>
    {{ end }}
  </ul>
  <div class="pagination" style="text-align:center; margin-top:1.5rem;">
    {{ if $paginator.HasPrev }}<a href="{{ $paginator.Prev.URL }}">← Prev</a>{{ end }}
    <strong>{{ $paginator.PageNumber }}</strong>
    {{ if $paginator.HasNext }}<a href="{{ $paginator.Next.URL }}">Next →</a>{{ end }}
  </div>
</div>

{{ else }}
{{ .Content }}
{{ end }}

<!-- 全站 Footer -->
<div class="global-footer">LOST & FOUND 像水消失在水中</div>

<!-- 弹窗订阅 -->
<div style="text-align:center;">
  <div class="subscribe-button">Get updates from my site</div>
</div>
<div class="subscribe-overlay">
  <div class="subscribe-popup">
    <div class="close-btn">&times;</div>
    <iframe src="https://364951749.substack.com/embed" scrolling="no"></iframe>
  </div>
</div>

<!-- 彩蛋：It'll pass -->
{{ $fire := `
<div id="fire-pass" style="position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);
font-size:6rem;font-weight:bold;color:white;text-align:center;pointer-events:none;z-index:1000;white-space:nowrap;">
It'll pass
</div>
<canvas id="fire-canvas" style="position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:999;"></canvas>
<script>
(function(){
  const fireText = document.getElementById('fire-pass');
  const canvas = document.getElementById('fire-canvas');
  const ctx = canvas.getContext('2d');
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;

  const rect = fireText.getBoundingClientRect();
  const centerX = rect.left + rect.width/2;
  const centerY = rect.top + rect.height/2;

  class Particle {
    constructor(x,y,char){
      this.x=x;this.y=y;
      this.vx=(Math.random()-0.5)*2;
      this.vy=Math.random()*-1-0.5;
      this.alpha=1;this.char=char;
      this.color='white';
    }
    update(){this.x+=this.vx;this.y+=this.vy;this.alpha-=0.02;}
    draw(){ctx.globalAlpha=this.alpha;ctx.fillStyle=this.color;ctx.font="64px sans-serif";ctx.fillText(this.char,this.x,this.y);}
  }

  let particles=[];

  function explodeText(){
    const text = fireText.textContent;
    const fontSize=64;
    fireText.style.display='none';
    for(let i=0;i<text.length;i++){
      const charX = centerX - text.length*fontSize/4 + i*fontSize*0.6;
      const charY = centerY;
      particles.push(new Particle(charX,charY,text[i]));
    }
    animate();
  }

  function animate(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    particles.forEach(p=>{p.draw();p.update();});
    particles = particles.filter(p=>p.alpha>0);
    if(particles.length>0){requestAnimationFrame(animate);}else{canvas.style.display='none';}
  }

  window.addEventListener('load', ()=>{explodeText();});
})();
</script>
`}}
{{ $fire | safeHTML }}

<script>
// 弹窗订阅逻辑
document.querySelector('.subscribe-button').addEventListener('click',function(){
  document.querySelector('.subscribe-overlay').style.display='flex';
});
document.querySelector('.subscribe-overlay .close-btn').addEventListener('click',function(){
  document.querySelector('.subscribe-overlay').style.display='none';
});
document.querySelector('.subscribe-overlay').addEventListener('click',function(e){
  if(e.target===this){this.style.display='none';}
});
</script>

{{ end }}
