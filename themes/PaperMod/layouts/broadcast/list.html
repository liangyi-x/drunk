<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LOST & FOUND</title>
<style>
body { margin:0; padding:0; background:#1f1f1f; color:#ddd; font-family:sans-serif; overflow:hidden; transition: filter 1.2s ease-in-out;}
.container { position:relative; z-index:1; max-width:800px; margin:0 auto; padding:2rem 1rem; opacity:0; transition:opacity 1.5s ease-in-out;}
.page-title { text-align:center; color:#fff; font-size:2.2rem; margin-bottom:1.5rem; }
.broadcast-input-wrapper { display:flex; gap:0.5rem; margin-bottom:1.5rem; }
#broadcast-input { flex:1; padding:0.5rem; border:none; border-radius:6px; background:rgba(255,255,255,0.08); color:#eee; }
#broadcast-send { padding:0.5rem 0.9rem; border:none; border-radius:6px; background:rgba(80,80,80,0.6); color:#fff; cursor:pointer; }
#broadcast-send:hover { background: rgba(100,100,100,0.8); }
.broadcast-list { display:flex; flex-direction:column; gap:0.8rem; }
.broadcast-card { background: rgba(255,255,255,0.05); padding:1rem; border-radius:8px; transition: all 0.3s ease; cursor:pointer; }
.broadcast-card:hover { transform: translateY(-4px); backdrop-filter: blur(8px); box-shadow:0 4px 16px rgba(0,0,0,0.5);}
.broadcast-card.dissolve { animation: cardFade 0.8s forwards; }
@keyframes cardFade { 0%{transform:rotate(0deg);opacity:1;}100%{transform:rotate(6deg);opacity:0;} }
.broadcast-message { font-size:1rem; margin-bottom:0.4rem; }
.broadcast-time { font-size:0.85rem; color:#aaa; text-align:right; }
#lostfound { text-align:center; margin:2rem 0; font-style:italic; color:rgba(200,200,200,0.7); cursor:pointer; transition:0.3s; }
#lostfound:hover { color:#7fffd4; }

#spell-overlay { position:fixed; inset:0; background:rgba(0,0,0,0.35); pointer-events:none; opacity:0; transition:opacity 1.2s ease-in-out; z-index:999; }

#vinyl-container { position:absolute; top:50%; left:50%; transform:translate(-50%, -50%) scale(0.8); width:200px; height:200px; opacity:0; }
.vinyl-ring { position:absolute; border-radius:50%; top:50%; left:50%; transform:translate(-50%, -50%); }
#outer-ring { width:200px; height:200px; background:#001f3f; }
#middle-ring { width:160px; height:160px; background:#000; }
#inner-ring { width:60px; height:60px; background:#fff; }
#vinyl-text { text-align:center; color:#ffe0b2; font-size:1rem; margin-top:8px; opacity:0; transition:opacity 0.5s ease-in-out; }

#people-text { position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); color:#330000; font-size:1.6rem; font-weight:bold; text-shadow:0 0 12px #440000; opacity:0; transition: opacity 0.8s ease-in-out;}

#wave { position:absolute; bottom:0; left:0; width:100%; height:80px; background: #001f3f; border-top-left-radius:50% 20px; border-top-right-radius:50% 20px; transform:translateY(100%); opacity:0; transition:opacity 1s ease-in-out;}
</style>
</head>
<body>
<div class="container" id="main-container">
  <h1 class="page-title">LOST & FOUND</h1>
  <div class="broadcast-input-wrapper">
    <input type="text" id="broadcast-input" placeholder="it hasn't passed…"/>
    <button id="broadcast-send">See you Sunday？</button>
  </div>
  <div class="broadcast-list" id="broadcasts"></div>
  <div id="lostfound">在不可能之海里</div>
</div>

<div id="spell-overlay">
  <div id="vinyl-container">
    <div class="vinyl-ring" id="outer-ring"></div>
    <div class="vinyl-ring" id="middle-ring"></div>
    <div class="vinyl-ring" id="inner-ring"></div>
    <div id="vinyl-text">Tomorrow is another day</div>
  </div>
  <div id="people-text">People make mistakes.</div>
  <div id="wave"></div>
</div>

<script type="module">
// Firebase 广播功能
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js";
import { getFirestore, collection, addDoc, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-firestore.js";
const firebaseConfig = { apiKey:"AIzaSyCcerqGJVSsMwLs7eoRjATE8X7bplWsD54", authDomain:"drunk-broadcast.firebaseapp.com", projectId:"drunk-broadcast", storageBucket:"drunk-broadcast.firebasestorage.app", messagingSenderId:"998143016108", appId:"1:998143016108:web:87c3a60b853aaf75f27309" };
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const ref = collection(db,"broadcasts");
const inputEl = document.getElementById("broadcast-input");
const sendBtn = document.getElementById("broadcast-send");
const listEl = document.getElementById("broadcasts");
sendBtn.onclick=async()=>{const v=inputEl.value.trim(); if(!v) return; await addDoc(ref,{message:v,timestamp:new Date()}); inputEl.value="";};
inputEl.addEventListener("keydown",e=>{if(e.key==="Enter") sendBtn.click();});
const q=query(ref,orderBy("timestamp","desc"));
onSnapshot(q,snap=>{listEl.innerHTML=""; snap.forEach(doc=>{const data=doc.data(); const d=document.createElement("div"); d.className="broadcast-card"; d.innerHTML=`<div class="broadcast-message">${data.message}</div><div class="broadcast-time">${data.timestamp.toDate().toLocaleString()}</div>`; d.onclick=()=>d.classList.add("dissolve"); listEl.appendChild(d);});});
window.addEventListener("load",()=>{document.getElementById("main-container").style.opacity="1";});
</script>

<script>
// 黑胶三环旋转+海浪同步动画
const lostfound = document.getElementById("lostfound");
const spellOverlay = document.getElementById("spell-overlay");
const vinylContainer = document.getElementById("vinyl-container");
const vinylText = document.getElementById("vinyl-text");
const peopleText = document.getElementById("people-text");
const wave = document.getElementById("wave");

lostfound.onclick = () => {
  spellOverlay.style.opacity = "1";
  vinylContainer.style.opacity = "1";
  vinylText.style.opacity = "1";
  wave.style.opacity = "1";
  wave.style.transform="translateY(0)";

  const duration = 4000;
  let start = null;
  let wavePhase = 0;

  function animateFrame(timestamp){
    if(!start) start = timestamp;
    let progress = Math.min((timestamp-start)/duration,1);
    let rotation = 360*progress;
    let scale = 0.8 + 0.2*progress;
    vinylContainer.style.transform = `translate(-50%, -50%) scale(${scale}) rotate(${rotation}deg)`;

    // 海浪随旋转波动
    wave.style.transform = `translateY(${Math.sin(wavePhase)*5}px)`;
    wavePhase += 0.05;

    if(progress<1) requestAnimationFrame(animateFrame);
  }
  requestAnimationFrame(animateFrame);

  setTimeout(()=>{
    // 黑胶淡出旋转
    const fadeStart = performance.now();
    function fadeFrame(timestamp){
      const progress = Math.min((timestamp-fadeStart)/1000,1);
      const rotation = 360 + 360*progress;
      const scale = 1 - 0.3*progress;
      const opacity = 1 - progress;
      vinylContainer.style.transform = `translate(-50%, -50%) scale(${scale}) rotate(${rotation}deg)`;
      vinylContainer.style.opacity = opacity;
      wave.style.opacity = 1-progress;
      wave.style.transform = `translateY(${Math.sin(wavePhase)*5*(1-progress)}px)`;
      wavePhase += 0.05;
      if(progress<1) requestAnimationFrame(fadeFrame);
    }
    requestAnimationFrame(fadeFrame);
    vinylText.style.opacity="0";

    setTimeout(()=>{
      peopleText.style.opacity="1";

      setTimeout(()=>{
        spellOverlay.style.opacity="0";
        peopleText.style.opacity="0";
      },2000);

      setTimeout(()=>{window.location.href="https://liangyi-x.github.io/drunk/";},2800);

    },1000);

  },4000);
};
</script>
</body>
</html>
