<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LOST & FOUND</title>

<style>
/* ===========================================
   ç”µå½±åŒ–æ·±æµ·èƒŒæ™¯ï¼ˆæ¸å˜ + ç»†é¢—ç²’ï¼‰
=========================================== */
body {
  margin: 0;
  padding: 0;
  background: radial-gradient(circle at 50% 70%, #0d0d15, #04040a 70%);
  overflow: hidden;
  color: #f0f0f0;
  font-family: "Helvetica Neue", sans-serif;
}

/* æ·±æµ·æµåŠ¨è¿·é›¾å±‚ */
#mist {
  position: fixed;
  inset: 0;
  background: url('https://raw.githubusercontent.com/liyuppp/cdn/main/mist.png');
  background-size: 200% 200%;
  opacity: 0.22;
  animation: mistMove 25s ease-in-out infinite alternate;
  pointer-events:none;
}

@keyframes mistMove {
  0% { background-position: 40% 40%; }
  100% { background-position: 60% 80%; }
}

/* å…‰ç²’å­å±‚ */
#particles {
  position: fixed;
  inset: 0;
  pointer-events:none;
  z-index: 1;
}

/* é¡µé¢ä¸»ä½“å®¹å™¨ */
.container {
  position: relative;
  max-width: 800px;
  margin: 0 auto;
  padding: 2.6rem 1.2rem;
  z-index: 5;
  opacity: 0;
  animation: pageFadeIn 1.8s ease forwards;
}

@keyframes pageFadeIn {
  to { opacity: 1; }
}

.page-title {
  text-align: center;
  font-size: 2.4rem;
  letter-spacing: 2px;
  margin-bottom: 1.6rem;
  color: #fff;
  text-shadow: 0 0 12px rgba(150,150,255,0.3);
}

/* è¾“å…¥æ¡†åŒºåŸŸ */
.broadcast-input-wrapper {
  display: flex;
  gap: 0.6rem;
  margin-bottom: 1.6rem;
}

#broadcast-input {
  flex: 1;
  padding: 0.65rem;
  border: none;
  border-radius: 8px;
  background: rgba(255,255,255,0.08);
  color: #eee;
}

#broadcast-send {
  padding: 0.6rem 0.9rem;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  background: rgba(255,255,255,0.1);
  color: #fff;
}

/* å¹¿æ’­åˆ—è¡¨ */
.broadcast-list {
  display:flex;
  flex-direction:column;
  gap:14px;
  max-height: 360px;
  overflow-y:auto;
  padding-right:4px;
}

/* å¡ç‰‡é£æ ¼ï¼šç”µå½±æ„Ÿæ¯›ç»ç’ƒ */
.broadcast-card {
  position: relative;
  padding: 16px 14px 14px 14px;
  padding-right: 46px;
  border-radius: 10px;
  background: rgba(255,255,255,0.06);
  backdrop-filter: blur(6px);
  transition: 0.35s;
  cursor: pointer;
 }
.broadcast-card:hover {
  background: rgba(255,255,255,0.12);
  transform: translateY(-3px);
}

/* å°é»‘çŒ«åˆ é™¤é”® */
.delete-btn {
  position: absolute;
  top: 6px;
  right: 10px;
  font-size: 1.25rem;
  cursor: pointer;
  opacity: 0.55;
  transition: 0.25s;
  user-select: none;
}
.delete-btn:hover {
  opacity:1;
  transform: scale(1.1);
}

/* æ¶ˆæ•£åŠ¨ç”» */
.broadcast-card.dissolve {
  animation: cardFade 0.65s forwards;
}
@keyframes cardFade {
  0% { opacity: 1; transform: rotate(0deg) scale(1); }
  100% { opacity: 0; transform: rotate(4deg) scale(0.85); }
}

/* footer */
#lostfound {
  margin: 2rem 0;
  text-align:center;
  font-style:italic;
  opacity:0.8;
  cursor:pointer;
  transition: 0.3s;
}
#lostfound:hover {
  opacity:1;
}
</style>
</head>

<body>

<div id="mist"></div>
<canvas id="particles"></canvas>

<div class="container" id="main-container">
  <h1 class="page-title">LOST & FOUND</h1>

  <div class="broadcast-input-wrapper">
    <input id="broadcast-input" placeholder="it hasn't passâ€¦" />
    <button id="broadcast-send">See you Sundayï¼Ÿ</button>
  </div>

  <div class="broadcast-list" id="broadcasts"></div>

  <div id="lostfound">åœ¨ä¸å¯èƒ½ä¹‹æµ·é‡Œ</div>
</div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js";
import { 
  getFirestore, collection, addDoc, query, orderBy, onSnapshot, deleteDoc 
} from "https://www.gstatic.com/firebasejs/10.6.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey:"AIzaSyCcerqGJVSsMwLs7eoRjATE8X7bplWsD54",
  authDomain:"drunk-broadcast.firebaseapp.com",
  projectId:"drunk-broadcast",
  storageBucket:"drunk-broadcast.firebasestorage.app",
  messagingSenderId:"998143016108",
  appId:"1:998143016108:web:87c3a60b853aaf75f27309"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const ref = collection(db, "broadcasts");

const inputEl = document.getElementById("broadcast-input");
const sendBtn = document.getElementById("broadcast-send");
const listEl = document.getElementById("broadcasts");

/* å‘é€å¹¿æ’­ */
sendBtn.onclick = async () => {
  const v = inputEl.value.trim();
  if (!v) return;
  await addDoc(ref, { message: v, timestamp: new Date() });
  inputEl.value = "";
};
inputEl.addEventListener("keydown", e => {
  if (e.key === "Enter") sendBtn.click();
});

/* æ¸²æŸ“å¹¿æ’­ */
const q = query(ref, orderBy("timestamp", "desc"));
onSnapshot(q, snap => {
  listEl.innerHTML = "";

  snap.forEach(doc => {
    const data = doc.data();

    const card = document.createElement("div");
    card.className = "broadcast-card";

    const del = document.createElement("div");
    del.className = "delete-btn";
    del.textContent = "ğŸˆ";
    
    /* çœŸåˆ é™¤ */
    del.onclick = async (e) => {
      e.stopPropagation();
      await deleteDoc(doc.ref);
    };

    card.innerHTML = `
      <div class="broadcast-message">${data.message}</div>
      <div class="broadcast-time">${data.timestamp.toDate().toLocaleString()}</div>
    `;
    card.appendChild(del);

    /* ç‚¹å‡»å¡ç‰‡ = æ·¡å‡º + DOM ç§»é™¤ï¼ˆä½†ä¸åˆ  Firebaseï¼‰ */
    card.onclick = () => {
      card.classList.add("dissolve");
      setTimeout(() => card.remove(), 600);
    };

    listEl.appendChild(card);
  });
});
</script>

<!-- å…‰ç²’å­æ•ˆæœ canvas -->
<script>
const canvas = document.getElementById("particles");
const ctx = canvas.getContext("2d");

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resize();
window.onresize = resize;

let particles = [];
for (let i = 0; i < 90; i++) {
  particles.push({
    x: Math.random()*canvas.width,
    y: Math.random()*canvas.height,
    r: Math.random()*2.4 + 0.6,
    dx: (Math.random()-0.5)*0.3,
    dy: (Math.random()-0.5)*0.3
  });
}

function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle = "rgba(255,255,255,0.7)";
  particles.forEach(p => {
    ctx.beginPath();
    ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
    ctx.fill();
    p.x += p.dx;
    p.y += p.dy;
    if (p.x<0||p.x>canvas.width) p.dx*=-1;
    if (p.y<0||p.y>canvas.height) p.dy*=-1;
  });
  requestAnimationFrame(draw);
}
draw();
</script>

</body>
</html>
