<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LOST & FOUND</title>
<style>
body { margin:0; padding:0; background:#1f1f1f; color:#ddd; font-family:sans-serif; overflow:hidden; transition: filter 1.2s ease-in-out;}
.container { position:relative; z-index:1; max-width:800px; margin:0 auto; padding:2rem 1rem; opacity:0; transition:opacity 1.5s ease-in-out;}
.page-title { text-align:center; color:#fff; font-size:2.2rem; margin-bottom:1.5rem; }
.broadcast-input-wrapper { display:flex; gap:0.5rem; margin-bottom:1.5rem; }
#broadcast-input { flex:1; padding:0.5rem; border:none; border-radius:6px; background:rgba(255,255,255,0.08); color:#eee; }
#broadcast-send { padding:0.5rem 0.9rem; border:none; border-radius:6px; background:rgba(80,80,80,0.6); color:#fff; cursor:pointer; }
#broadcast-send:hover { background: rgba(100,100,100,0.8); }
.broadcast-list { display:flex; flex-direction:column; gap:0.8rem; max-height:300px; overflow-y:auto; }

/* Âç°Áâá */
.broadcast-card { 
  position:relative;
  background: rgba(255,255,255,0.05); 
  padding:1rem; 
  border-radius:8px; 
  transition: all 0.3s ease; 
  cursor:pointer; 
  overflow:hidden;
}
.broadcast-card:hover { transform: translateY(-4px); backdrop-filter: blur(8px); box-shadow:0 4px 16px rgba(0,0,0,0.5);}
.broadcast-card.dissolve { animation: cardFade 0.8s forwards; }
@keyframes cardFade { 0%{transform:rotate(0deg);opacity:1;}100%{transform:rotate(6deg);opacity:0;} }

/* Â∞èÈªëÁå´ÊåâÈíÆ */
.delete-btn {
  position:absolute;
  top:6px;
  right:8px;
  font-size:18px;
  cursor:pointer;
  user-select:none;
  opacity:0.7;
  transition:0.2s;
}
.delete-btn:hover { opacity:1; transform:scale(1.2); }

/* Êµ∑Ê∞¥ÂêûÊ≤°ÔºàÂà†Èô§ÔºâÂä®Áîª */
.broadcast-card.delete-effect {
  animation: oceanFade 1.2s forwards;
}
@keyframes oceanFade {
  0%   { opacity:1; filter:blur(0px); transform:translateY(0);}
  40%  { opacity:0.8; filter:blur(2px); transform:translateY(3px);}
  70%  { opacity:0.4; filter:blur(6px); transform:translateY(12px);}
  100% { opacity:0; filter:blur(12px); transform:translateY(28px);}
}

.broadcast-message { font-size:1rem; margin-bottom:0.4rem; }
.broadcast-time { font-size:0.85rem; color:#aaa; text-align:right; }

#lostfound { text-align:center; margin:2rem 0; font-style:italic; color:rgba(200,200,200,0.7); cursor:pointer; transition:0.3s; }
#lostfound:hover { color:#7fffd4; }
#spell-overlay { position:fixed; inset:0; background:rgba(0,0,0,0.35); pointer-events:none; opacity:0; transition:opacity 1.2s ease-in-out; z-index:999; }

#vinyl-container { position:absolute; top:50%; left:50%; transform:translate(-50%, -50%) scale(0.8); width:200px; height:200px; opacity:0; }
.vinyl-ring { position:absolute; border-radius:50%; top:50%; left:50%; transform:translate(-50%, -50%); }
#outer-ring { width:200px; height:200px; background:#001f3f; }
#middle-ring { width:160px; height:160px; background:#000; }
#inner-ring { width:60px; height:60px; background:#fff; }
#vinyl-text { position:absolute; bottom:-25px; width:100%; text-align:center; color:#ffe0b2; font-size:1rem; opacity:0; transition:opacity 0.5s ease-in-out; }

#people-text {
  position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); font-size:1.8rem; font-weight:bold; opacity:0; text-align:center;
  background: linear-gradient(90deg, #330000, #550000, #330000);
  -webkit-background-clip:text; color:transparent;
  text-shadow:0 0 6px #440000, 0 0 12px #220000;
  animation: floatText 2s ease-in-out infinite alternate, bloodFlow 3s linear infinite, glowPulse 2s ease-in-out infinite alternate;
}
@keyframes floatText { 0%{transform:translate(-50%, -50%);} 50%{transform:translate(-50%, -48%);} 100%{transform:translate(-50%, -50%);} }
@keyframes bloodFlow {
  0% { background-position:0 0; }
  50% { background-position:50% 0; }
  100% { background-position:100% 0; }
}
@keyframes glowPulse { 0%{opacity:0.7;}50%{opacity:1;}100%{opacity:0.7;} }

#wave { position:absolute; bottom:0; left:0; width:100%; height:80px; background:#001f3f; border-top-left-radius:50% 20px; border-top-right-radius:50% 20px; transform:translateY(100%); opacity:0; transition:opacity 1s;}
</style>
</head>
<body>
<div class="container" id="main-container">
  <h1 class="page-title">LOST & FOUND</h1>
  <div class="broadcast-input-wrapper">
    <input type="text" id="broadcast-input" placeholder="it hasn't pass‚Ä¶"/>
    <button id="broadcast-send">See you SundayÔºü</button>
  </div>
  <div class="broadcast-list" id="broadcasts"></div>
  <div id="lostfound">Âú®‰∏çÂèØËÉΩ‰πãÊµ∑Èáå</div>
</div>

<div id="spell-overlay">
  <div id="vinyl-container">
    <div class="vinyl-ring" id="outer-ring"></div>
    <div class="vinyl-ring" id="middle-ring"></div>
    <div class="vinyl-ring" id="inner-ring"></div>
    <div id="vinyl-text">Tomorrow is another day</div>
  </div>
  <div id="people-text">People make mistakes.</div>
  <div id="wave"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js";
import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey:"AIzaSyCcerqGJVSsMwLs7eoRjATE8X7bplWsD54",
  authDomain:"drunk-broadcast.firebaseapp.com",
  projectId:"drunk-broadcast",
  storageBucket:"drunk-broadcast.firebasestorage.app",
  messagingSenderId:"998143016108",
  appId:"1:998143016108:web:87c3a60b853aaf75f27309"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const ref = collection(db,"broadcasts");

const inputEl = document.getElementById("broadcast-input");
const sendBtn = document.getElementById("broadcast-send");
const listEl = document.getElementById("broadcasts");

sendBtn.onclick = async () => {
  const v = inputEl.value.trim();
  if(!v) return;
  await addDoc(ref, { message:v, timestamp:new Date() });
  inputEl.value="";
};

inputEl.addEventListener("keydown",e=>{
  if(e.key==="Enter") sendBtn.click();
});

const q=query(ref,orderBy("timestamp","desc"));
onSnapshot(q,snap=>{
  listEl.innerHTML="";
  snap.forEach(docSnap=>{
    const data=docSnap.data();

    const d=document.createElement("div");
    d.className="broadcast-card";

    d.innerHTML=`
      <div class="delete-btn">üêà‚Äç‚¨õ</div>
      <div class="broadcast-message">${data.message}</div>
      <div class="broadcast-time">${data.timestamp.toDate().toLocaleString()}</div>
    `;

    // ÁÇπÂáªÂç°ÁâáÊú¨‰Ωì = Ê∑°Âá∫Ôºå‰∏çÂà†Èô§
    d.onclick = (e)=>{
      if(e.target.classList.contains("delete-btn")) return;
      d.classList.add("dissolve");
    };

    // ÁÇπÂáªÂ∞èÈªëÁå´ = ÁúüÂà†Èô§ + Ê∫∂Ëß£ÊàêÊµ∑Ê∞¥
    d.querySelector(".delete-btn").onclick = async (e)=>{
      e.stopPropagation();
      d.classList.add("delete-effect");
      setTimeout(async ()=>{
        await deleteDoc(doc(db,"broadcasts", docSnap.id));
      },1100);
    };

    listEl.appendChild(d);
  });
});

window.addEventListener("load",()=>{
  document.getElementById("main-container").style.opacity="1";
});
</script>

<script>
/* ‰øùÁïô‰Ω†ÂéüÊù•ÁöÑÁâπÊïà */
const lostfound = document.getElementById("lostfound");
const spellOverlay = document.getElementById("spell-overlay");
const vinylContainer = document.getElementById("vinyl-container");
const vinylText = document.getElementById("vinyl-text");
const peopleText = document.getElementById("people-text");
const wave = document.getElementById("wave");

lostfound.onclick = () => {
  spellOverlay.style.opacity = "1";
  vinylContainer.style.opacity = "1";
  vinylText.style.opacity = "1";
  wave.style.opacity = "1";
  wave.style.transform="translateY(0)";

  const duration = 3600;
  let start = null;
  let wavePhase = 0;

  function animateFrame(t){
    if(!start) start = t;
    const progress = Math.min((t-start)/duration,1);
    const rotation = 360*progress;
    const scale = 0.8 + 0.2*progress;
    vinylContainer.style.transform = `translate(-50%, -50%) scale(${scale}) rotate(${rotation}deg)`;
    wave.style.transform = `translateY(${Math.sin(wavePhase)*6}px)`;
    wavePhase += 0.06;
    if(progress<1) requestAnimationFrame(animateFrame);
  }
  requestAnimationFrame(animateFrame);

  setTimeout(()=>{
    const fadeDur = 800;
    let fadeStart = performance.now();
    function fadeFrame(t2){
      const prog = Math.min((t2-fadeStart)/fadeDur,1);
      const rot = 360 + 360*prog;
      const sc = 1 - 0.3*prog;
      const op = 1 - prog;
      vinylContainer.style.transform = `translate(-50%, -50%) scale(${sc}) rotate(${rot}deg)`;
      vinylContainer.style.opacity = op;
      wave.style.opacity = op;
      if(prog<1) requestAnimationFrame(fadeFrame);
    }
    requestAnimationFrame(fadeFrame);
    vinylText.style.opacity="0";

    setTimeout(()=>{
      peopleText.style.opacity="1";
      setTimeout(()=>{
        peopleText.style.opacity="0";
        spellOverlay.style.opacity="0";
        wave.style.opacity="0";
        vinylContainer.style.opacity="0";
        setTimeout(()=>{ window.location.href = "https://liangyi-x.github.io/drunk/"; },800);
      },1800);

    }, fadeDur);

  }, duration);
};
</script>
</body>
</html>
