<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CLIMBING WALL</title>
<style>
body {
  margin:0; padding:0;
  font-family:sans-serif;
  background: linear-gradient(#0a0a1f, #050514);
  overflow:hidden;
}
#wall {
  position:relative;
  width:100vw;
  height:100vh;
  background: url('https://raw.githubusercontent.com/liyuppp/cdn/main/mist.png');
  background-size:cover;
}
.hold {
  position:absolute;
  cursor:pointer;
  display:flex; justify-content:center; align-items:center;
  color:#fff; font-size:12px; text-align:center;
  transition: transform 0.2s;
}
.hold:hover { transform: scale(1.3); }
#infoBox {
  position:absolute; bottom:10px; left:50%; transform:translateX(-50%);
  background:rgba(0,0,0,0.6); color:#fff;
  padding:10px 16px; border-radius:8px; max-width:300px; text-align:center;
  pointer-events:none;
}
#lines { position:absolute; top:0; left:0; width:100%; height:100%; z-index:0; }
#jelly { position:absolute; top:20px; right:20px; width:50px; height:50px; cursor:pointer; z-index:10; }
#jelly svg { width:100%; height:100%; }
</style>
</head>
<body>

<div id="wall">
  <canvas id="lines"></canvas>
  <div id="jelly" onclick="goHome()">
    <svg viewBox="0 0 64 64">
      <circle cx="32" cy="32" r="30" fill="#3da4f5"/>
      <path d="M20,40 C25,30 39,30 44,40" stroke="#fff" stroke-width="2" fill="none"/>
    </svg>
  </div>
</div>

<div id="infoBox">BETA</div>

<script>
// 岩点示例数据
const holds = [
  {id:'A', x:10, y:20, shape:'circle', color:'#f55', info:'线路A: 初级'},
  {id:'B', x:40, y:15, shape:'ellipse', color:'#5f5', info:'线路B: 中级'},
  {id:'C', x:70, y:30, shape:'diamond', color:'#55f', info:'线路C: 高级'},
  {id:'D', x:60, y:60, shape:'pentagon', color:'#fa0', info:'线路D: 技巧'},
  {id:'E', x:20, y:50, shape:'circle', color:'#f0f', info:'线路E: 挑战'}
];

// 创建岩点
const wall = document.getElementById('wall');
const infoBox = document.getElementById('infoBox');

holds.forEach(h=>{
  const div = document.createElement('div');
  div.className='hold';
  div.dataset.id = h.id;
  div.style.left = h.x + '%';
  div.style.top = h.y + '%';
  div.style.background = h.color;
  div.style.width = '30px';
  div.style.height = '30px';
  div.style.zIndex = 5;
  div.style.clipPath = shapeToClip(h.shape);
  div.title = h.info;
  wall.appendChild(div);

  div.onmousedown = e=>{
    e.preventDefault();
    let offsetX = e.clientX - div.offsetLeft;
    let offsetY = e.clientY - div.offsetTop;
    function move(ev){
      let newX = ev.clientX - offsetX;
      let newY = ev.clientY - offsetY;
      div.style.left = newX + 'px';
      div.style.top = newY + 'px';
      drawLines(); // 动态更新线路
    }
    function up(){ window.removeEventListener('mousemove', move); window.removeEventListener('mouseup', up);}
    window.addEventListener('mousemove', move);
    window.addEventListener('mouseup', up);
  };

  div.onclick = e=>{
    infoBox.textContent = h.info;
    e.stopPropagation();
  };
});

// 不同形状对应 clip-path
function shapeToClip(shape){
  switch(shape){
    case 'circle': return 'circle(50% at 50% 50%)';
    case 'ellipse': return 'ellipse(50% 30% at 50% 50%)';
    case 'diamond': return 'polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%)';
    case 'pentagon': return 'polygon(50% 0%, 100% 38%, 82% 100%, 18% 100%, 0% 38%)';
    default: return 'circle(50%)';
  }
}

// 多条线路示例
const routes = [
  {holds:['A','B','C'], color:'#fff'},
  {holds:['D','E','C'], color:'#0ff'}
];

const canvas = document.getElementById('lines');
const ctx = canvas.getContext('2d');
function resizeCanvas(){ canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
resizeCanvas();
window.addEventListener('resize', ()=>{ resizeCanvas(); drawLines(); });

// 根据路线画线
function drawLines(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  routes.forEach(route=>{
    ctx.strokeStyle = route.color;
    ctx.lineWidth = 3;
    ctx.beginPath();
    route.holds.forEach((id,i)=>{
      const holdDiv = document.querySelector(`.hold[data-id="${id}"]`);
      const rect = holdDiv.getBoundingClientRect();
      const x = rect.left + rect.width/2;
      const y = rect.top + rect.height/2;
      if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
    });
    ctx.stroke();
  });
}

// 回主页
function goHome(){ window.location.href="https://liangyi-x.github.io/drunk/"; }

</script>

</body>
</html>
